<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		{% seo %}
		{% feed_meta %}
		<link rel="stylesheet" href="{{ site.baseurl }}/css/screen.css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
		<link rel="icon" type="image/png" href="{{ site.baseurl }}/favicon.png">
		<script src="/js/jquery-3.3.1.min.js" type="text/javascript"></script>
	</head>
	<body>
		<header>
			<div class="container">
				<div class="company-name">
					<a href="{{ site.baseurl }}/"><img src="{{ site.baseurl }}/images/logo.svg" alt="KorGE Logo" width="95" height="33" /></a>
					<span id="version"></span>

					<script type="text/javascript">
						const versionVersion = "V1"
						const versionTimeLocalStorageKey = `versionCacheTime${versionVersion}`;
						const versionLocalStorageKey = `version${versionVersion}`;

						function updateVersion() {
							let version = localStorage.getItem(versionLocalStorageKey);
							let rversion = (version == 'vundefined' || version == 'undefined') ? 'v1.5.6.2' : (version || 'v1.5.6.2');
							document.getElementById('version').innerText = `${rversion}`;
						}

						updateVersion();

						async function fetchJson(url) {
							let data = await fetch(url);
							let json = await data.json();
							return json;
						}

						async function doDynamic() {
							let versionCacheTime = localStorage.getItem(versionTimeLocalStorageKey);
							if (!versionCacheTime || ((Date.now() - versionCacheTime) > 24 * 3600 * 1000)) {

								try {
									let data = await fetchJson("https://korlibs-api.soywiz.com/versions/korge-plugins");
									console.log(data);
									localStorage.setItem(versionTimeLocalStorageKey, Date.now());
									localStorage.setItem(versionLocalStorageKey, 'v' + data.version.replace(/^release-/, ''));
									updateVersion();
								} catch (e) {
									let data = await fetchJson("https://api.github.com/repos/korlibs/korge-plugins/releases/latest");
									console.log(data);
									localStorage.setItem(versionTimeLocalStorageKey, Date.now());
									localStorage.setItem(versionLocalStorageKey, 'v' + data.tag_name.replace(/^release-/, ''));
									updateVersion();
								}
							}
						}
						doDynamic();
					</script>
				</div>
				{% include navigation.html %}
			</div>
		</header>
		{{ content }}
		<footer>
			<div class="container">
				<div class="footer-columns">
					{% for column in site.data.footer %}
					<ul class="footer-links">
						{% for link in column.links %}
							<li><a {% if link.new_window %}target="_blank"{% endif %} href="{% include relative-src.html src=link.link %}" {% if link.social_icon %}class="{{ link.social_icon }}-icon"{% endif %}>
								{% if link.social_icon %}
									{% include social-icon.html icon=link.social_icon %}
								{% endif %}
								{{ link.name }}</a></li>
						{% endfor %}
					</ul>
					{% endfor %}
				</div>
				<p class="copyright">&copy; {{ site.time | date: '%Y' }} Carlos Ballesteros Velasco. â€¢ <a href="https://cloudcannon.com/">Template by CloudCannon</a></p>
			</div>
		</footer>
		<script>
			document.getElementById("open-nav").onclick = function () {
				document.body.classList.toggle("nav-open");
				return false;
			};
		</script>
	</body>
</html>
